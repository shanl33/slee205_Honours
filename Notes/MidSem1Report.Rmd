---
title: "Code-based open-source software for Teaching Interactive Data Visualisation"
subtitle: "Mid Semester 1 Report"
author: "Shan-I Lee"
output: html_document
runtime: shiny
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```
### Introduction
This report will outline a possible structure for introducing graduate students to interactive data visualisation techniques. A possible sequence for instruction will be discussed, followed by examples of applying interactive techniques with the open-source tools researched so far. The challenges posed by large datasets will also be examined. Areas in need of further research will be identified throughout the report and then summarised.

### A sequence for instruction
The data analysis process described by Cook and Swayne (2007) provides a structure and context for meaningful interactive visualisation. They describe how visualisation fits into the process of identifying the problem statement, preparing the data, engaging in exploratory data analysis (EDA) and quantitative analysis, and lastly in the presentation of findings. Graduate students will have encountered the use of static visuals in exploratory data analysis, quantitative analysis (typically for the purpose of checking model assumptions) and the use of graphics in presenting findings. However the role of visualisation in cleaning data may be less familiar. In particular the use of interactive visuals to identify and explore missing values, as described by Cook and Swayne (2007, Chapter 3), could provide a meaningful context for students to practice their interactive techniques and tools.
It is proposed that students initially practice interactive tools and techniques with an EDA frame of mind, but with more expertise explore specific applications, such as dealing with missing values or exploring cluster analysis visually. From the onset students need to be aware of how the interactive toolbox they are building can be of use throughout the data analysis process. A worked example demonstrating the use of interactive tools at different stages of the process, may assist in establishing this holistic view of interactive data visualisation. The airlines data from the 2009 ASA Data Expo could be used as a holistic and motivational exemplar before introducing interactive tools and techniques. A subset of the airlines data will be the main dataset used in this report, but the inclusion of other datasets for teaching will be addressed. Initial work on an introductory exemplar will be detailed, followed by a summary of the tools researched so far. A possible sequence for introducing the tools, resulting from each tool's coverage of interactive techniques, will then be outlined.

#### Choice of datasets
The examples in this report will be mainly drawn from the subset of flights by the A
Three data sets will be used for demonstration and practice, mtcars from the R datasets package, a data set of the fatty acid compositions of Italian olive oils and a subset of the airlines data from the 2009 ASA Data Expo. The data sets have been chosen for their size and combination of numeric and categorical variables. The familiarity of the mtcars' context and its small size, allows the learner to focus on experimenting with the interactive tool and technique at hand. Meanwhile the olive oils data set may provide more meaningful interaction as the relationships between variables are not as obvious. Furthermore insight into the Olive Oils data can be gained from interacting with bivariate scatterplots to complex multi-dimensional tours, as described in detail by Cook and Swayne. Lastly the subset of the airlines data comprising of more than 50 000 observations, is relatively small in the context of 'big data' but it will be large enough to demonstrate some of the challenges posed with 'scaling up' interactive tools.
Inclusion of a data set with only categorical vars? Interactive mosaic plot with changing nesting.
Airlines data is not cleaned yet.

#### An introductory exemplar
The purpose of the introductory exemplar is to provide students with a holistic view of interactive data visualisation. When learning the specific tools and techniques students can easily lose sight of the wider purpose of the interaction, other than 'making it work'. The context of the airlines data is easy to relate to and hence naturally motivates meaningful questions to investigate with the data. Furthermore the airlines data has enough depth for use as an exemplar, while leaving room for students to use again for further exploration. The suggested exemplar, below, uses a subset of the airlines data. 

Below is an outline of how the exemplar fits into the data analysis process. 

The problem statement: "How did the 9/11 terrorist attacks affect the AQ airline carrier?"
Investigating the broader problem statement of "How did the 9/11 terrorist attacks affect airlines?" is currently hindered by challenges with visually representing large datasets. This will be discussed as an area in need of further research.
Preparing data: We can see beyond January that there may have been inconsistencies in recording the day of the week with its respective day of the month. (We can also see a gap in the days following September 11).
Exploratory data analysis: There appears to be two main structures for relationships between the variables ..... January, July and August appear to have a similar structure with flights departing throughout the day and more varied delays?  While the remaining months are similar in structure. January, July and August correspond with the school holiday seasons in the US and hence suggests in the quantitative analysis, September should only be compared with the non-school-holiday months that are expected to be similar in structure. 
Quantitative analysis: One approach could be to build a model for a measure of airline efficiency such as the length of delays. Month could be included as a regressor and hence the adjusted effect of the month being September compared to other months of interest. This type of analysis would require diagnostics checks on multicollinearity. The linking of a correlation heatmap with scatterplots showcased by Sievert (2017?) demonstrates how interaction can be used to overcome the difficulties of utilising a scatterplot matrix when there are a large number of variables (see https://plot.ly/r/shinyapp-linked-click/ ).

```{r}
#Code scatter heat map linked
```

The exemplar provides a brief glimpse on how interactive visualisation fits into the data analysis process. It should be emphasised that visuals from multiple views are required in analysis and the exemplar is not a complete exploration or 'solution'.  Instead it is intended for students to return to this data set to explore more complex interactive visualisations, such as multivariate cluster analysis. This possibility needs to be investigated further but it could follow a similar sequence as outlined by Cook and Swayne (2007) using the Italian Olive Oils data set. 
Similarly students familiar with database querying may return to the problem statement with their interactive toolbox to analyse the data across the years. 
The visualisations suggested in the exemplar demonstrate in a meaningful context the various interactive techniques that students will encounter, such as the 'off-plot' subset selection on the parallel coordinate plot, compared to the 'on-plot' brushing of the linked correlation heatmap, to select a pairwise scatterplot to display. The exemplar might also be students' first encounter with a parallel coordinate plot. Although the focus is on interactive techniques, an introduction to useful, but less well known, multivariate visuals like parallel coordinate plots and mosaic plots may be required. An interactive visualisation using mosaic plots, of the categorical variables of the airlines data, could be developed (see Chapter 5, Hofmann, 2006). The introduction of mosaic plots could be discussed as one approach towards addressing the challenges of visualising datasets with a large number of observations and categorical variables. 
The exemplar needs to be further developed and possibly extended, but the intention for it to set the stage for acquiring interactive techniques for a meaningful purpose remains.

#### 'Off-plot' and 'on-plot' interactive tools / Introducing interactive tools for EDA
Differentiating between off-plot and on-plot interactive tools provides a possible sequence for introducing R packages that enable interactive techniques. It also provides a way to understand the options that are created by utilising combinations of the packages together. More guidance may be required for becoming familiar with packages that allow for on-plot interactions, while self-directed learning should be encouraged for off-plot interactive tools. The table below summarises the coverage of the R packages researched so far, across the interactive techniques described by Cook and Swayne (2007). Areas in need of further research have been indicated in italics.

Of all the R packages listed above, graduate students are most likely to have had experience with using Shiny. Students who have not encountered Shiny before can be directed to its clearly documented tutorials (https://shiny.rstudio.com/tutorial/).  In particular 'Part 1 - How to build a Shiny app' familiarises students with creating inputs such as sliders and radio buttons for off-plot interaction. The video tutorial for 'Part 2 - How to customize reactions', could be used as part of a 'flipped classroom' approach to learning how to use Shiny for more advanced interactive techniques.  A hands-on face-to-face tutorial following the viewing of the online material for Part 2, may enable students to pick up the material faster than they would working independently. The in-lecture tutorial would also act as a checkpoint for students to be on a par with the level of expertise required to proceed with utilising Shiny in combination with other packages.
Placing the onus on students to pick up the basics of Shiny will enable the focus of instruction to be on R packages for on-plot interactions. More guidance is required here since there is a variety of packages to choose from and the documentation seems less user-friendly from a novice's perspective. 
The plotly package provides a starting point that leads to a variety of interactive techniques. The default settings for a plotly object allows for tooltip identification and scaling. Students have the option of converting plots in ggplot2 to plotly objects or directly creating plots using the plot_ly(). The plot_ly function takes a similar layered Grammar of Graphics (Wilkinson 2005) approach as ggplot2. Although the graphics of ggplot2 are more comprehensive, creating plots via plot_ly() should also be utilised since it interacts more directly with the plotly.js library (Sievert 2017?). This will have significant implications for interactive visuals that display a large number of observations individually. The difference in run time between producing a scatterplot of the 'AQ' airline data (>50 000 observations) using plot_ly() directly, compared to ggplotly(), is shown below.

```{r}
# Run time
```

The 'tooltip' argument for plotly objects allows for customisation of the identification information to display when hovering on a graphical feature. The possibility of including identification information other than those visible in the aesthetics of the plot, can be explored further by examining the 'layerData' and 'originalData' arguments of plotly objects.
Proceeding onto combining Plotly with Crosstalk introduces the key interactive technique of brushing to link multiple plots. This can also be achieved by using Plotly and Shiny together, but the SharedData environment of the crosstalk package directly allows brushing to be initiated in any of the linked plots and retains the unbrushed points in all plots by default. However the crosstalk package is not appropriate for use with large data sets and currently supports only linked brushing and identification via filtering views, for certain HTML widgets where observations are individually displayed (see https://rstudio.github.io/crosstalk/ ).  Further research into how the 'htmlwidgets' package can be used with Crosstalk, with or without the 'reactive' function in Shiny, is still required. For example the use of D3 graphics enables the interactive technique of dragging points, but how this would be meaningfully related to the data analysis process needs further thought.  Linking with Leaflet maps would also be of interest, since like many other 'real-life' datasets, the 'airlines' data lends itself to a geospatial representation that could enhance interactive visualisation. Examining the use of Crosstalk with htmlwidgets would provide more varied and in-depth practice of utilising the SharedData environment for students.

The following example of using Plotly and Crosstalk together demonstrates how persistent brushing can be easily incorporated by an argument in the plotly function 'highlight'.

```{r}

```

Utilising the "plotly_click" mode in the event_data function for plotly objects in shiny apps allows for linked brushing on area plots of categorical variables. The off-plot interactive Shiny tools that students have independently acquired can also be incorporated with Plotly. (Put here if include shiny drop down in code below)

```{r}
# Link bar plot with scatter for the olives data? Or try the flights data w months on the bars and use plotly to see if responds faster. Or use a mosaic plot with olives data (can also include shiny drop down menu to choose which pairwise scatterplot to show?)
```

Students should be able to identify a similar code structure between this example and the linked brushing between the correlation heatmap and pairwise scatterplots encountered in the exemplar.  
It may be possible to brush aggregate plots of real-valued variables with further research into how plotly captures traces for layers of ggplot2 plots, as described by Sievert in 'Extending ggplotly()' hyperlink to  https://cpsievert.github.io/plotly_book/extending-ggplotly.html 

### Large datasets
As previously mentioned the AQ subset of the airlines data is relatively small in the context of 'big data', but with over 50 000 observations and 19 variables, it provides students with some exposure to the challenges of interactive visualisations with large datasets. A different database query of the airline data would easily extend the size beyond the AQ subset. 
Datasets can be large in terms of the number of observations, or the number of variables involved, or both. The challenges of displaying visuals with a large number of observations will be discussed first, followed by possible student experiences of interactive visualisations involving a large number of variables. 

#### Datasets with a large number of observations
The challenges posed by datasets with a large number of observations become quickly apparent with the airlines data. The parallel coordinate plot in the exemplar demonstrates the problem of overplotting. The delay in interactivity between the heatmap and scatterplot highlights the sluggishness that results from plotting a large number of points on the screen.  The parallel coordinate plot uses interaction to create conditional plots and hence avoids the issue of plotting time. Unwin (2006) argues plotting a sample of a large dataset is insufficient for identifying errors, outliers or local features. Similarly Hofmann (2006) emphasises, as with any visualisation, we need to represent both the global and local features of large data sets.  Visually representing a large number of observations individually requires more research into OpenGL environments.  
A discussion with students regarding graphical formats would also entail from working with large data sets. The scalable property of object orientated formats is desirable, but impractical for storage when a visual contains a large number of points. Hence the use of raster images is the more efficient choice, since mapping to pixels is unaffected by the number of points involved (Unwin 2006). The importance of choosing an appropriate graphical format can be easily demonstrated by comparing the run time required in R to export any scatterplot of the AQ airline data, as a PDF and PNG file (the image consists of over 50 000 points).

#### Datasets with a large number of variables
The number of real-valued variables in the airlines data opens the possibility of introducing students to the use of multi-dimensional tours, as demonstrated by Cook and Swayne (2006) with the Italian Olive Oils dataset using GGobi. Further research would be needed to confirm whether the biplot function in R, combined with either a Shiny slider or a htmlwidget frame, would be able to facilitate tours. Otherwise students could use GGobi, not only to experience an interactive visualisation of joint distributions, but also for exposure to open-source software that supports both interactive graphics and data analysis. The R packages discussed so far provide "pipe" components, but do not have the capabilities of a "pipeline" to facilitate data-to-plot and more importantly the inverse, plot-to-data updates, after visual interactions (Wickham et al. 2007). 

### Areas in need of further research 

```{r}

```


## Conclusion
An overview of how interactive visualisation fits into the underlying data analysis process could be demonstrated with 
Balance between Focus on the techniques and purposes of interaction. The tools used to achieve them are likely to change, but still necessary to pick up in order to engage in data visualisation.
The challenge of focusing on the uses of interactive visualisation for data analysis rather than producing some thing to showcase a particular software tool.